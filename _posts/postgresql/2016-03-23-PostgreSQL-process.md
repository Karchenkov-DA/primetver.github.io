---
layout: page-fullwidth
#
# Content
#
subheadline: "PostgreSQL"
title: "Типовой процесс миграции баз данных Oracle на PostgreSQL"
teaser: "Компания может иметь различные причины для миграции своих приложений с одной платформы СУБД на другую: сокращение затрат на ПО, упрощение гетерогенной ИТ-инфраструктуры или получение преимуществ от использования новых технологий."
categories:
  - Решения
tags:
  - postgresql
  - migration
#
# Styling
#
header:
    image_fullwidth: corp-w.png
    title: "PostgreSQL"
image:
  header: postgresql_logo.png
  thumb:  postgresql_logo.png
  homepage: corp-w.png
  caption: 
  url: 
breadcrumb: true
permalink: /postgresql/migration
---

Перед принятием решения о смене СУБД необходимо располагать следующей информацией: 

- сроки миграции;
- риски и затраты при проведении внедрения новой СУБД;
- время простоя системы;
- затраты на переобучение эксплуатирующего персонала.
  
## Основные этапы процесса миграции


**Обследование.** На данном этапе осуществляется оценка сроков, рисков, затрат для бизнеса и потребителей сервиса и составляется подробный план миграции с учетом большого количества условий. Производится обследование автоматизированной системы с целью выявления места СУБД в системе и исследования сервисов, предоставляемых СУБД

**Анализ.** На данном этапе осуществляется детальный анализ структуры БД, применяемых технологий резервирования и выявления технических особенностей эксплуатации БД

**Миграция.** На данном этапе осуществляется проработка внутренней структуры БД, хранимых процедур, осуществляется подбор технических средств резервирования и механизмов репликации. Дополнительно разрабатывается подробный план переноса данных с учетом требований к времени простоя системы

**Внедрение.** На данном этапе осуществляется развертывание и перенос данных на объекте Заказчика. Также производится подключение сервисов и приложений к новой БД, осуществляется оценка их работы на реальных объемах данных. Производится оптимизация производительности БД

**Обучение.** На данном этапе проводится обучение специалистов Заказчика эксплуатирующих систему

**Сопровождение.** На данном этапе производится выявление проблем с производительностью, выявление неоптимального использования ресурсов, оказываются другие услуги, направленные на решение проблем в процессе эксплуатации системы

### Обследование
Осуществляется оценка окружения, в котором работает СУБД, формируется представление о системе, в рамках которой осуществляется эксплуатация СУБД, определяется перечень задач, которая решает АС. На данном этапе осуществляются:

- анализ проектной документации на АС. Формируется перечень задач, который решает АС. Выявляются связи с СУБД, сервисы и приложения (далее сервисы);
- рассмотрение каждого сервиса с точки зрения исполняемых запросов, нагрузки, создаваемой на БД, и критичности БД для сервиса;
- опрос Заказчика. Выявление неиспользуемых сервисов и прочих особенностей.

По результатам этапа у Исполнителя появляется представление об архитектуре АС и месте СУБД в рамках АС. 

### Анализ

 В рамках данного этапа следует определить и обозначить перед Заказчиком большую часть рисков и проблем, которые могут возникнуть в процессе миграции, обозначить примерный уровень затрат и влияние на предоставление сервисов пользователям. Для того чтобы более детально выявить проблемы и обозначить риски миграции необходимо как можно раньше произвести анализ структуры БД и ее окружения.

Анализ дает ответы на следующие вопросы: 

- Возможна ли миграция на PostgreSQL в принципе или трудозатраты будут настолько высоки, что гораздо проще и дешевле разработать новую систему на новой БД?
- Целесообразна ли миграция СУБД для конкретной системы?
- Какие проблемы призвана решить миграция (помимо отказа от проприетарного ПО), и будет ли миграция иметь негативные последствия для системы в целом и ее пользователей? 

Для того чтобы получить ответы на поставленные вопросы следует:

- произвести анализ структуры исходной БД (Oracle);
- в процессе анализа выявить объекты специфичные для исходной БД (пакеты, триггеры, хранимые процедуры и т.д.). По каждому специфичному объекту исходной БД проработать технологию миграции на целевую БД PostgreSQL;
- произвести анализ внешней инфраструктуры СУБД (наличие кластеризации, наличие горячего/холодного резервного серверов и механизмов репликации). Произвести анализ ОС, на которых функционирует СУБД;
- произвести анализ внутренней структуры БД и используемых дополнительных технологий Oracle (секционирование, сжатие, шифрование и т.д.). При наличии технологии в целевой БД (PostgreSQL) проработать алгоритм миграции. В случае отсутствия произвести анализ необходимости ее использования, и, если необходимость подтверждается, проработать обходные варианты с использованием имеющихся технологий в целевой БД (PostgreSQL);
- произвести анализ существующей стратегии резервного копирования исходной БД (Oracle) и возможности, а также достаточности технологии резервного копирования в целевой БД (PostgreSQL);
- произвести анализ существующей пользовательской нагрузки на исходную БД;
- произвести анализ объемов исходной БД и ежедневного прироста данных;
- выполнить оценку прикладного ПО, которое использует БД и подготовить заключение о необходимости внесения изменений в прикладное ПО;
- произвести анализ режима доступности БД и возможностей «даунтайма»;
- произвести анализ квалификации эксплуатирующего персонала и затрат на его переобучение;
- произвести анализ необходимости и объемов преобразования кода PL/SQL в PL/PGSQL.

 По результатам анализа всех приведенных вопросов составляется отчет, в который включаются:

- оценка целесообразности миграции;
- выгода от миграции;
- возможности миграции;
- оценки сроков миграции;
- прогнозы по трудоемкости и затратам на миграцию;
- разработка координационного плана миграции.

### Миграция

 После принятия решения о целесообразности миграции требуется детальная проработка следующих технических вопросов:

- в случае использования кластера или различного рода stanby-баз данных, которые синхронизируются, необходимо проработать аналогичные решения для PostgreSQL и опробовать их работу;
- необходимо выработать решения по резервному копированию данных СУБД PostgreSQL.

После проработки все технические решения документируются, также при необходимости производится адаптация документации на автоматизированную систему (Описание информационного Обеспечения, Руководство администратора БД).

После согласования технических решений выполняются работы непосредственно по миграции.

- очистка структуры БД от неиспользуемых или пустых объектов. Если в процессе миграции выявляются неиспользуемые объекты или пустые объекты, то они могут быть исключены из новой структуры БД, что положительно сказывается на производительности;
- адаптация модели хранения данных. Производится перенос существующей модели хранения данных с учетом особенностей СУБД PostgreSQL;
- в случае отсутствия возможности переноса производится переработка структуры БД без изменения функциональных возможностей;
- разработка процедур миграции данных;
- получение копии или тестовой копии данных исходной БД в объеме достаточном для отладки процедур миграции;
- отладка процедур миграции на стенде.


### Внедрение
На данном этапе у Заказчика производятся следующие работы:

- развертывание структуры БД PostgreSQL на тестовых средах Заказчика;
- подключение и проверка корректности работы сервисов;
- наполнение тестовых сред данными близкими к реальным объемам и запуск системы на новой БД совместно со специалистами Исполнителя и Заказчика. В процессе работы производится проверка процедур миграции данных в средах тестирования;
- настройка резервного копирования на тестовых средах. В процессе работы производится резервирование данных на реальных объемах. Производится оценка времени резервирования. Выбирается технологичное окно резервирования;
- оценка работы АС на новой БД, а также оптимизация производительности БД.

После успешного завершения работ в средах тестирования осуществляется разработка плана миграции БД в промышленной среде с учетом уровня критичности предоставления сервиса. После согласования плана миграции работы повторяются в промышленной среде системы.

По результатам работ по внедрению Заказчику предоставляется отчет о выполнении работ по миграции. 
 

### Обучение
Данный этап необходим для успешной эксплуатации системы на новой СУБД.

Производится знакомство с обновленной проектной документацией на систему. Четко обозначаются особенности, которые нужно учитывать при эксплуатации новой БД.

Подготавливаются рекомендации по возможной дальнейшей оптимизации БД (нормализации или денормализации таблиц, отказ от неоптимальных индексов или необходимости добавления новых индексов). 

### Сопровождение

 В процессе миграции могут остаться проблемы, которые не выявляются на этапе внедрения. Данный этап является важным при эксплуатации любой системы. На этапе сопровождения оказываются следующие услуги:

- оптимизация запросов. Выявление проблем с производительностью;
- консультации по использованию новой СУБД, решений по резервному копированию;
- анализ оптимальности структуры БД. Выявление неоптимального использования ресурсов;
- поддержка и участие в разрешении проблемных ситуаций.

## В заключение...

Смена платформы является достаточно трудоемким и затратным процессом. Однако, несмотря на все сложности процесса миграции при должном подходе риски могут быть минимизированы, а срок окупаемости затрат снижен до 1--2 лет.

СУБД с открытым кодом становятся все более привлекательными для Заказчиков, которые надеются снизить затраты на управление БД и избежать зависимости от конкретных поставщиков программного обеспечения.

Рынок свободно распространяемых СУБД предлагает широкий выбор продуктов, качественную поддержку и обширную экосистему вокруг каждого из решений. 

{% include seealso tag='' %}
